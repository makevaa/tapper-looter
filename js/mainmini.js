const bottomTabs=document.querySelectorAll("#bottom-bar > .tab"),invIcon=document.querySelector("#bottom-bar > .tab.inv > img"),views=document.querySelectorAll("#view-container > .view"),combatView=document.querySelector("#view-container > .combat.view"),lootItemContainer=document.getElementById("loot-container"),lootItemImage=document.querySelector(".loot-item"),lootItemNameContainer=document.getElementById("loot-name-container"),lootItemName=document.getElementById("loot-name"),lootItemLayers=document.querySelectorAll("#loot-container > .loot-item > .outer-wrap > .inner-wrap > .image"),lootItemNormalGlow=document.querySelector(".item-normal-glow"),enemyContainer=document.getElementById("enemy-container"),enemyNameElem=document.getElementById("enemy-name"),enemyImageContainer=document.getElementById("enemy-image-container"),enemyDamageOverlay=enemyImageContainer.querySelector(".damage-overlay"),enemyImageElem=document.getElementById("enemy-image"),enemyHpBarContainer=document.getElementById("enemy-hp-bar-container"),enemyHpBarMain=document.querySelector("#enemy-hp-bar-container > .bar.main"),enemyHpBarBg=document.querySelector("#enemy-hp-bar-container > .bar.bg"),enemyHpCurrent=document.querySelector("#enemy-hp-bar-container > .hp-container > .current"),enemyHpMax=document.querySelector("#enemy-hp-bar-container > .hp-container > .max"),invGrid=document.getElementById("inv-grid");let invSlots;const itemViewerName=document.querySelector("#item-viewer > .name-container > .name"),itemViewerQualityTitle=document.querySelector("#item-viewer > .name-container > .type-container > .quality-title"),itemViewerTypeTitle=document.querySelector("#item-viewer > .name-container > .type-container > .type"),itemViewerSellValueContainer=document.querySelector("#item-viewer > .name-container > .type-container > .value-container"),itemViewerSellValue=document.querySelector("#item-viewer > .name-container > .type-container > .value-container > .value"),itemViewerEffectsContainer=document.querySelector("#item-viewer > .name-container > .effects-container"),itemViewerContainer=document.querySelector("#item-viewer > .image-container"),itemViewerImage=document.querySelector("#item-viewer > .image-container > .viewer-item"),itemViewerBottomShadow=document.querySelector("#item-viewer > .image-container > .viewer-item > .item-bottom-shadow-container"),viewerItemLayers=document.querySelectorAll("#item-viewer > .image-container > .viewer-item > .outer-wrap > .inner-wrap > .image"),viewerItemNormalGlow=document.querySelector("#item-viewer > .image-container > .viewer-item > .outer-wrap > .inner-wrap > .item-normal-glow-container > .item-normal-glow"),sellSelectedButton=document.getElementById("sell-selected"),sellAllButtonButton=document.getElementById("sell-all"),equipButton=document.getElementById("equip-selected"),playerGoldElem=document.querySelector("#gold-container > .gold-amount-container > .gold-amount"),goldAnimContainer=document.querySelector("#gold-container > .gold-anim-container"),goldAnim=document.querySelector("#gold-container > .gold-anim-container > .gold-anim"),modal=document.getElementById("modal-container");let enemy={name:-1,dead:!1,hp:{max:settings.enemyMaxHp,current:settings.enemyMaxHp},lootItem:{},image:-1};class Player{constructor(){this.invSlots=30,this.inv=[],this.gold=0,this.goldFind=0,this.magicFind=0,this.kills=0,this.tab=0,this.damage={base:10,bonus:0,typeBonus:0},this.crit={chance:0,multiplier:1.5,baseMultiplier:1.5},this.equipment={weapon:-1,amulet:-1,artifact:-1}}}let player=new Player;const addGold=e=>{player.gold+=e,playerGoldElem.innerText=player.gold,runGoldAnim(e,!0)},itemQuality=[{name:"Weak",color:"#9d9d9d"},{name:"Normal",color:"#e6e6e6"},{name:"Magic",color:"#6969ff"},{name:"Rare",color:"#FFE400"},{name:"Epic",color:"#1eff00"},{name:"Legendary",color:"#ff8000"},];class Item{constructor(e,t,a,l,n,r,i){this.name=e,this.type=t,this.isWeapon=a,this.imageSrc=l,this.qualityLevel=n,this.sellValue=r,this.effects=i,this.looted=!1}}class Effect{constructor(e){this.name=e,this.text=""}}class DamageBonus extends Effect{constructor(e){super("DamageBonus"),this.value=e,this.text=`+${e} damage`}}class IncreasedValue extends Effect{constructor(e){super("IncreasedValue"),this.value=e,this.text=`+${e}% gold value `}}class TypeDamageBonus extends Effect{constructor(e,t){super("TypeDamageBonus"),this.value=e,this.type=t,this.text=`+${e} ${t} damage `}}class CritChance extends Effect{constructor(e){super("CritChance"),this.value=e,this.text=`Critical chance +${e}%`}}class CritDamage extends Effect{constructor(e){super("CritDamage"),this.value=e,this.text=`Critical damage +${e}%`}}class GoldFind extends Effect{constructor(e){super("GoldFind"),this.value=e,this.text=`Gain ${e}%  more gold`}}const createItemEffects=(e,t,a)=>{let l=["axe","bow","hammer","mace","spear","staff","sword"],n=[];if(t){let r=1;r+=a,a>1&&(r+=10);let i=(a+1)*10,o=new DamageBonus(ranNum(r,i));n.push(o),chance(10)}else;if(chance(50+3*a)&&!t){let m=(a+1)*4,s=selectFrom(l),c=new TypeDamageBonus(ranNum(1,m),s);n.push(c)}if(chance(50+3*a)){let p=(a+1)*2,y=new CritChance(ranNum(1,p));n.push(y)}if(chance(50+3*a)){let d=(a+1)*5,u=new CritDamage(ranNum(5,d));n.push(u)}if(chance(10)&&!t){let g=(a+1)*5,$=new GoldFind(ranNum(5,g));n.push($)}if(chance(10)&&a>-1){let v=ranNum(5,50),x=new IncreasedValue(v);n.push(x)}return n},createItem=(e="random",t="random")=>{let a=["amulet","artifact"],l=["axe","bow","hammer","mace","spear","staff","sword"],n=a.concat(l);"random"===e&&(e=selectFrom(n));let r=l.includes(e),i=`img/item/${e}${ranNum(1,itemImageAmounts[e])}.png`;"random"===t&&(t=0,chance(1)?t=5:chance(5)?t=4:chance(10)?t=3:chance(20)?t=2:chance(30)&&(t=1));let o=["normal","normal","magic","rare","legendary","mythic"],m=rpgItemGen.createItem(e,o[t]),s=5*t+1,c=s+2*s,p=ranNum(s,c),y=createItemEffects(e,r,t);for(let d of y)"IncreasedValue"===d.name&&(p+=Math.floor(p*(d.value/100)));let u=new Item(m,e,r,i,t,p,y);return u},createEnemy=()=>{enemy.dead=!1,enemy.name=heroGen.getName();let e=ranNum(1,settings.enemyImageAmount);enemy.image=`img/creature/creature (${e}).jpg`,enemy.hp.max=ranNum(settings.enemy.hp.min,settings.enemy.hp.max),enemy.lootItem=createItem();let t=!1;chance(5)&&player.kills>50&&(t=!0),t&&(enemy.hp.max=10*enemy.hp.max,enemy.lootItem=createItem("random",ranNum(4,5))),enemy.hp.current=enemy.hp.max},setEnemyStyle=()=>{enemyNameElem.innerText=enemy.name,enemyImageElem.style.backgroundImage=`url('${enemy.image}')`;let e=enemy.hp.current/enemy.hp.max*100;enemyHpBarMain.style.width=`${e}%`,enemyHpBarBg.style.width=`${e}%`,enemyHpCurrent.innerText=enemy.hp.current,enemyHpMax.innerText=enemy.hp.max},createLootItemLayers=()=>{for(let e=0;e<lootItemLayers.length;e++){let t=lootItemLayers[e];t.style.backgroundImage=`url('${enemy.lootItem.imageSrc}')`;let a=-Math.floor(lootItemLayers.length/2)+5*e;t.style.transform="translateZ("+a+"px"}},setLootItemStyle=()=>{let e=itemQuality[enemy.lootItem.qualityLevel].color;lootItemNormalGlow.style.boxShadow=`${e} 0px 0px 50px 20px`;let t=lootItemLayers[0],a=lootItemLayers[1];t.style.backgroundImage=`url('${enemy.lootItem.imageSrc}')`,a.style.backgroundImage=`url('${enemy.lootItem.imageSrc}')`,enemy.lootItem.qualityLevel>1?(t.style.filter=`drop-shadow(${e} 0px 0px 5px)`,a.style.filter=`drop-shadow(${e} 0px 0px 5px)`):(t.style.filter="none",a.style.filter="none"),lootItemName.innerText=enemy.lootItem.name,lootItemName.style.color=e},setViewerImage=e=>{for(let t=0;t<viewerItemLayers.length;t++){let a=viewerItemLayers[t];a.style.backgroundImage=`url('${e.imageSrc}')`;let l=-Math.floor(viewerItemLayers.length/2)+2*t;a.style.transform="translateZ("+l+"px"}let n=itemQuality[e.qualityLevel].color;viewerItemNormalGlow.style.boxShadow=`${n} 0px 0px 15px 15px`;let r=`inset 0px -40px 40px 0px ${hexToRgbaStr(n,.2)}`;itemViewerContainer.style.boxShadow=r;let i=viewerItemLayers[0],o=viewerItemLayers[1];e.qualityLevel>1?(i.style.filter=`drop-shadow(${n} 0px 0px 5px)`,o.style.filter=`drop-shadow(${n} 0px 0px 5px)`):(i.style.filter="none",o.style.filter="none")},flashInvIcon=()=>{invIcon.classList.add("full"),setTimeout(()=>{invIcon.classList.remove("full")},100)},setInvIcon=()=>{player.inv.length>=player.invSlots?invIcon.setAttribute("src","img/chest_full.png"):invIcon.setAttribute("src","img/chest.png")},takeLoot=()=>{let e=enemy.lootItem;if(e.looted)return!1;if(player.inv.length>=player.invSlots)return flashInvIcon(),!1;e.looted=!0,player.inv.push(e),setItemToSlot(e,invSlots[player.inv.length-1],player.inv.length-1),invIcon.setAttribute("src","img/chest_open.png");let t=lootItemImage.getBoundingClientRect(),a=invIcon.getBoundingClientRect(),l=(a.y-t.y)*.7;lootItemImage.style.transform=`translateY(${l}px) scale(0.2)`,lootItemNameContainer.style.transform=`translateY(${a.y-t.y}px) scale(0)`;setTimeout(()=>{createEnemy(),setLootItemStyle(),setEnemyStyle(),enemyContainer.classList.remove("hidden"),lootItemContainer.classList.add("hidden"),lootItemImage.style.transform="translateY(0%) scale(1)",lootItemNameContainer.style.transform="translateY(0%) scale(1)",setInvIcon(),save()},200)},setCombatView=()=>{enemy.dead?(enemyContainer.classList.add("hidden"),setTimeout(()=>{lootItemContainer.classList.remove("hidden")},300)):enemyContainer.classList.remove("hidden")},attackEnemy=e=>{if(enemy.dead)return!1;let t=player.damage.base;t+=player.damage.bonus,t+=player.damage.typeBonus;let a=animData.atk2;chance(player.crit.chance)&&(t*=player.crit.multiplier,t=Math.floor(t),a=animData.atk2red),enemy.hp.current-=t,enemy.hp.current<=0?(playAnim(animData.explosion1,!1,e),enemy.dead=!0,player.kills++,setCombatView()):(enemyImageContainer.classList.add("damaged"),enemyDamageOverlay.classList.remove("hidden"),playAnim(a,!0,e),setTimeout(()=>{enemyImageContainer.classList.remove("damaged"),enemyDamageOverlay.classList.add("hidden")},100));let l=enemy.hp.current/enemy.hp.max*100;enemyHpBarMain.style.width=`${l}%`,enemyHpBarBg.style.width=`${l}%`,enemyHpCurrent.innerText=enemy.hp.current,save()},showTabView=e=>{for(let t of views)t.classList.add("hidden");for(let a of(views[e].classList.remove("hidden"),bottomTabs))a.classList.remove("selected");bottomTabs[e].classList.add("selected"),player.tab=e,save()},setListeners=()=>{for(let e=0;e<bottomTabs.length;e++){let t=bottomTabs[e];t.addEventListener("click",t=>{showTabView(e)})}combatView.addEventListener("click",e=>{}),window.oncontextmenu=e=>(e.preventDefault(),e.stopPropagation(),!1),lootItemContainer.addEventListener("click",e=>{takeLoot()}),enemyContainer.addEventListener("click",e=>{let t=e.clientX,a=e.clientY;log(`x: ${t}, y: ${a}`);let l={x:t,y:a};attackEnemy(l)}),invGrid.addEventListener("click",e=>{"true"!==e.target.getAttribute("data-empty")?showInItemViewer(e.target):(clearInvSelection(),clearItemViewer())}),sellSelectedButton.addEventListener("click",e=>{let t=document.querySelector("#inv-grid > .slot.selected");null!=t&&"true"!==t.getAttribute("data-empty")&&(sellItem(t.getAttribute("data-index")),setInvIcon())}),sellAllButtonButton.addEventListener("click",e=>{sellAll()}),equipButton.addEventListener("click",e=>{let t=document.querySelector("#inv-grid > .slot.selected");null!=t&&"true"!==t.getAttribute("data-empty")&&equipItem(t.getAttribute("data-index"),t)});let a=Object.getOwnPropertyNames(player.equipment);for(let l=0;l<a.length;l++){let n=document.querySelector(`#equipment-container > .slot.${a[l]} .image-container `);n.addEventListener("click",e=>{unequipItem(a[l])})}let r=document.getElementById("menu-button");r.addEventListener("click",e=>{showMenu(!0)});let i=document.querySelector("#menu > .button.help"),o=document.querySelector("#menu > .button.about");i.addEventListener("click",e=>{showModal("help")}),o.addEventListener("click",e=>{showModal("about")})},clearInvSelection=()=>{let e=invGrid.querySelector(".slot > .item.selected"),t=invGrid.querySelector(".slot.selected");null!==e&&e.classList.remove("selected"),null!==t&&(t.classList.remove("selected"),itemViewerContainer.style.boxShadow="inset  0px -30px 30px 0px rgba(0,0,0, 0.5)")},showInItemViewer=e=>{e.getAttribute("data-index");let t=e.getAttribute("data-item-index");clearInvSelection();let a=e.querySelector(".item");a.classList.add("selected"),e.classList.add("selected");let l=player.inv[t];if(void 0===l)return clearItemViewer(),!1;let n=l.name;itemViewerName.innerText=n,itemViewerName.style.color=itemQuality[l.qualityLevel].color;let r=l.type;for(let i of("artifact"===r&&(r="talisman"),itemViewerQualityTitle.innerText=itemQuality[l.qualityLevel].name,itemViewerTypeTitle.innerText=r,itemViewerSellValue.innerText=l.sellValue,itemViewerEffectsContainer.innerHTML="",l.effects)){let o=document.createElement("div");o.classList.add("effect");let m="◆";o.innerText=`${m} ${i.text}`,itemViewerEffectsContainer.append(o)}setViewerImage(l),itemViewerSellValueContainer.classList.remove("hidden"),itemViewerImage.classList.remove("hidden"),itemViewerBottomShadow.classList.remove("hidden")},clearItemViewer=()=>{itemViewerName.innerText="",itemViewerQualityTitle.innerText="",itemViewerTypeTitle.innerText="",itemViewerEffectsContainer.innerHTML="",itemViewerSellValueContainer.classList.add("hidden"),itemViewerImage.classList.add("hidden"),itemViewerBottomShadow.classList.add("hidden")},playAnim=(e,t=!1,a)=>{let l=document.createElement("canvas");l.classList.add("anim-canvas"),l.width=e.frameW,l.height=e.frameH;l.width<300&&l.height<300&&(l.width=300,l.height=300);let n=enemyImageElem.getBoundingClientRect(),r=n.x+n.width/2-l.width/2,i=n.y+n.height/2-l.height/2;if(r=Math.floor(r),i=Math.floor(i),t){let o=50;r=ranNum(r-o,r+o),i=ranNum(i-o,i+o)}l.style.left=`${r}px`,l.style.top=`${i}px`,document.body.prepend(l);let m=l.getContext("2d"),s={canvas:l,ctx:m,w:e.frameW,h:e.frameH,frames:e.rows*e.framesPerRow,frameDur:e.frameDur,rows:e.rows,framesPerRow:e.framesPerRow,frame:0,prevTime:0,image:e.image};animate(s)},animate=e=>{let t=window.requestAnimationFrame,a=window.cancelAnimationFrame,l,n=!1,r=e.canvas,i=e.ctx,o=0,m=s=>{if(n)return a(l),r.remove(),!0;l=t(m);let c=s-e.prevTime;if(c>=e.frameDur){e.prevTime=s,e.frame++,o++;let p=Math.floor(e.frame/e.framesPerRow);e.rows>1&&e.frame%e.framesPerRow==0&&(o=0),i.clearRect(0,0,r.width,r.height),i.drawImage(e.image,o*e.w,p*e.h,e.w,e.h,0,0,r.width,r.height)}e.frame>=e.frames&&(n=!0)};l=m()},createTestItems=e=>{for(let t=0;t<e;t++){let a=createItem();player.inv.push(a)}},createInvSlots=()=>{for(let e=0;e<player.invSlots;e++){let t=document.createElement("div");t.classList.add("slot"),t.setAttribute("data-empty",!0),t.setAttribute("data-index",e);let a=document.createElement("div");a.classList.add("item");let l=document.createElement("img");l.classList.add("image"),l.setAttribute("src","img/transp.png"),l.setAttribute("alt","inv slot"),a.append(l),t.append(a),invGrid.append(t)}invSlots=document.querySelectorAll("#inv-grid > .slot")},createEquipmentSlots=()=>{let e=Object.getOwnPropertyNames(player.equipment),t=document.getElementById("equipment-container");for(let a=0;a<e.length;a++){let l=document.createElement("div"),n=e[a];l.classList.add("slot"),l.classList.add(n);let r=document.createElement("div");r.classList.add("top-row");let i=document.createElement("div");i.classList.add("label");let o;"weapon"===n&&(o="WEP"),"amulet"===n&&(o="AMU"),"artifact"===n&&(o="TAL"),i.innerText=o;let m=document.createElement("div");m.classList.add("name"),r.append(m);let s=document.createElement("div");s.classList.add("mid"),s.append(i);let c=document.createElement("div");c.classList.add("image-wrapper");let p=document.createElement("div");p.classList.add("image-container");let y=document.createElement("img");y.classList.add("image"),y.setAttribute("src",`img/empty_slot_${n}.png`),y.setAttribute("alt","equipment slot"),p.append(y),c.append(p),s.append(c);let d=document.createElement("div");d.classList.add("effects"),s.append(d),l.append(r),l.append(s),t.append(l)}},setItemToSlot=(e,t,a)=>{let l=e.imageSrc,n=e.qualityLevel,r=t.querySelector(".item");t.setAttribute("data-empty",!1),t.setAttribute("data-item-index",a);let i=`0px 0px 0px 1px ${itemQuality[n].color}, 0px 0px 0px 4px rgba(0, 0, 0, 1), inset 0px 0px 5px 5px rgba(0,0,0,0.5), /* vignette */ 0px 0px 3px 3px rgba(0, 0, 0, 0.5)`;r.style.boxShadow=i;let o=t.querySelector(".item > .image");o.setAttribute("src",l),n>1?o.style.filter=`drop-shadow(${itemQuality[n].color} 0px 0px 4px)`:o.style.filter="none"},setInvItems=()=>{let e=player.inv;for(let t=0;t<invSlots.length;t++)invSlots[t],clearInvSlot(t);main:for(let a=0;a<e.length;a++)search:for(let l=0;l<invSlots.length;l++){let n=invSlots[l];if("true"===n.getAttribute("data-empty")){setItemToSlot(e[a],n,a),n.setAttribute("data-empty",!1);break search}}},clearInvSlot=e=>{let t=invSlots[e];t.setAttribute("data-empty",!0);let a=t.querySelector(".item");a.style.boxShadow="0px 0px 0px 1px rgb(100, 100, 100), 0px 0px 0px 4px rgba(0, 0, 0, 1), inset 0px 0px 5px 5px rgba(0,0,0,0.5), /* vignette */ 0px 0px";let l=t.querySelector(".item > .image");l.setAttribute("src","img/transp.png")},sellItem=e=>{let t=player.inv[e],a=t.sellValue;addGold(Math.floor(a+=a*player.goldFind)),player.inv.splice(e,1),clearInvSlot(e),clearInvSelection(),clearItemViewer(),setInvItems()},sellAll=()=>{invGrid.scrollTop=0;for(let e=player.inv.length-1;e>=0;e--)setTimeout(()=>{sellItem(e)},1*Math.abs(e-player.inv.length));setInvIcon()},runGoldAnim=(e,t)=>{let a,l;t?(a="+",l="lime"):(a="-",l="red"),goldAnim.style.color=l,goldAnim.innerHTML=`${a}${e}`,goldAnimContainer.style.transition="opacity 0s",goldAnimContainer.style.opacity=1,setTimeout(()=>{goldAnimContainer.style.transition="opacity 1s",goldAnimContainer.style.opacity=0},100)},equipItem=(e,t)=>{let a=player.inv[e],l;a.isWeapon?l="weapon":"amulet"===a.type?l="amulet":"artifact"===a.type&&(l="artifact");let n=null;player.equipment[l]instanceof Item?(n=player.equipment[l],player.inv[e]=n):player.inv.splice(e,1),player.equipment[l]=a,setInvItems(),showInItemViewer(t),setEquippedItemsStyle(),setPlayerStats(),save()},unequipItem=e=>{let t=player.equipment[e];return t instanceof Item&&(player.inv.length>=player.invSlots?(flashInvIcon(),!1):void(player.inv.push(t),player.equipment[e]=-1,setInvItems(),setEquippedItemsStyle(),setPlayerStats(),save()))},setEquippedItemsStyle=()=>{let e=Object.getOwnPropertyNames(player.equipment),t=document.getElementById("equipment-container");for(let a=0;a<e.length;a++){let l=t.querySelector(`.slot.${e[a]}`);clearEquipmentSlot(l,e[a]);let n=player.equipment[e[a]];if(n instanceof Item){let r=l.querySelector(".image-container"),i=r.querySelector("img.image");i.setAttribute("src",n.imageSrc);let o=n.qualityLevel,m=itemQuality[o].color,s=`0px 0px 0px 1px ${m}, 0px 0px 0px 4px rgba(0, 0, 0, 1), inset 0px 0px 5px 5px rgba(0,0,0,0.5), /* vignette */ 0px 0px 3px 3px rgba(0, 0, 0, 0.5)`;r.style.boxShadow=s,o>1?i.style.filter=`drop-shadow(${m} 0px 0px 4px)`:i.style.filter="none";let c=l.querySelector(".name");c.innerText=n.name,c.style.color=m;let p=l.querySelector(".effects");for(let y of(p.innerHTML="",n.effects)){let d=document.createElement("div");d.classList.add("effect");let u=`◆ ${y.text}`;d.innerText=u,p.append(d)}}}setPlayerStats()},clearEquipmentSlot=(e,t)=>{e.setAttribute("data-empty",!0);let a=e.querySelector(".image-container"),l=e.querySelector(".name"),n=e.querySelector(".effects");a.style.boxShadow="0px 0px 0px 1px rgb(100, 100, 100), 0px 0px 0px 4px rgba(0, 0, 0, 1), inset 0px 0px 5px 5px rgba(0,0,0,0.5), /* vignette */ 0px 0px";let r=a.querySelector("img.image");r.setAttribute("src",`img/empty_slot_${t}.png`),r.style.filter="none",l.innerText="",n.innerHTML=""},setPlayerStats=()=>{let e=0,t=0,a=0,l=0,n=0,r=0,i=Object.getOwnPropertyNames(player.equipment);for(let o of i){let m=player.equipment[o];if(m instanceof Item)for(let s of m.effects)"DamageBonus"===s.name&&(e+=s.value),"TypeDamageBonus"===s.name&&s.type===player.equipment.weapon.type&&(t+=s.value),"CritChance"===s.name&&(a+=s.value),"CritDamage"===s.name&&(l+=s.value/100),"MagicFind"===s.name&&(n+=s.value/100),"GoldFind"===s.name&&(r+=s.value/100)}player.damage.bonus=e,player.damage.typeBonus=t,player.crit.chance=a,player.crit.multiplier=l+player.crit.baseMultiplier,player.magicFind=n,player.goldFind=r;let c=document.querySelector("#player-stats-container .damage"),p=document.querySelector("#player-stats-container .crit-chance"),y=document.querySelector("#player-stats-container .crit-damage"),d=document.querySelector("#player-stats-container .magic-find"),u=document.querySelector("#player-stats-container .gold-find"),g=player.damage.base+player.damage.bonus+player.damage.typeBonus;c.innerText=g,p.innerText=`${Math.floor(player.crit.chance)}%`,y.innerText=`${Math.floor(100*player.crit.multiplier)}%`,d.innerText=`+${Math.floor(100*player.magicFind)}%`,u.innerText=`+${Math.floor(100*player.goldFind)}%`},setAnimImages=()=>{let e=Object.getOwnPropertyNames(animData);for(let t of e){let a=animData[t],l=new Image;l.src=a.imageSrc,a.image=l}},initNewGame=()=>{showMenu(!1),createEnemy(),setEnemyStyle(),setLootItemStyle(),player=new Player,setInvItems(),setPlayerStats(),setEquippedItemsStyle(),showTabView(0),save()};preloadImages(imagesToPreload).then(function(e){setAnimImages(),createInvSlots(),createEquipmentSlots(),saveExists()?(loadSave(),setLootItemStyle(),setCombatView()):initNewGame(),setEnemyStyle(),setInvItems(),setEquippedItemsStyle(),setPlayerStats(),setInvIcon(),setListeners(),showTabView(player.tab),save()},function(e){log("ERROR: failed to preload image: "+e)});